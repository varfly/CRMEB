(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-8e59b1b2"],{"0df8":function(e,t,i){},ed41:function(e,t,i){i("0df8")},ffd0:function(e,t,i){i.r(t);var n=i("2909"),a=i("c7eb"),s=i("1da1"),r=i("5530"),l=(i("99af"),i("caad"),i("d81d"),i("14d9"),i("a434"),i("2532"),i("2f62")),o=i("90e7");r={name:"systemrRole",data:function(){return{spinShow:!1,modals:!1,total:0,grid:{xl:7,lg:7,md:12,sm:24,xs:24},loading:!1,defaultExpandAll:!1,formValidate:{status:"",role_name:"",page:1,limit:20},tableList:[],formInline:{role_name:"",status:0,checked_menus:[],id:0},menusList:[],selectIds:[],modelTit:"",ruleValidate:{role_name:[{required:!0,message:"请输入身份昵称",trigger:"blur"}],status:[{required:!0,type:"number",message:"请选择是否开启",trigger:"change"}]},defaultProps:{children:"children",label:"title"}}},computed:Object(r.a)(Object(r.a)({},Object(l.d)("media",["isMobile"])),{},{labelWidth:function(){return this.isMobile?void 0:"80px"},labelPosition:function(){return this.isMobile?"top":"right"},labelPosition2:function(){return this.isMobile?"top":"right"}}),created:function(){this.getList()},methods:{changeExpandAll:function(){if(this.defaultExpandAll)for(var e in this.defaultExpandAll=!1,this.$refs.tree.store.nodesMap)this.$refs.tree.store.nodesMap[e].expanded=!1;else for(var t in this.defaultExpandAll=!0,this.$refs.tree.store.nodesMap)this.$refs.tree.store.nodesMap[t].expanded=!0},closed:function(){this.formInline={role_name:"",status:0,checked_menus:[],id:0},this.selectIds=[]},add:function(e){this.formInline.id=0,this.modelTit=e,this.modals=!0,this.getmenusList()},del:function(e,t,i){var n=this;t={title:t,num:i,url:"setting/role/".concat(e.id),method:"DELETE",ids:""};this.$modalSure(t).then((function(e){n.$message.success(e.msg),n.tableList.splice(i,1)})).catch((function(e){n.$message.error(e.msg)}))},onchangeIsShow:function(e){var t=this;e={id:e.id,status:e.status};Object(o.pb)(e).then(function(){var e=Object(s.a)(Object(a.a)().mark((function e(i){return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.$message.success(i.msg);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.$message.error(e.msg)}))},getList:function(){var e=this;this.loading=!0,this.formValidate.status=this.formValidate.status||"",Object(o.ob)(this.formValidate).then(function(){var t=Object(s.a)(Object(a.a)().mark((function t(i){var n;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=i.data,e.tableList=n.list,e.total=i.data.count,e.loading=!1;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.loading=!1,e.$message.error(t.msg)}))},userSearchs:function(){this.formValidate.page=1,this.getList()},edit:function(e,t){this.modelTit=t,this.formInline.id=e.id,this.modals=!0,this.rows=e,this.getIofo(e)},getmenusList:function(){var e=this;this.spinShow=!0,Object(o.X)().then(function(){var t=Object(s.a)(Object(a.a)().mark((function t(i){var n;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=i.data,e.menusList=n.menus,e.menusList.map((function(e,t){"主页"===e.title&&e.children.length&&e.children.map((function(e){})),e.expand=!1})),e.spinShow=!1;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.spinShow=!1,e.$message.error(t.msg)}))},getIofo:function(e){var t=this;this.spinShow=!0,Object(o.nb)(e.id).then(function(){var e=Object(s.a)(Object(a.a)().mark((function e(i){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=i.data,t.formInline=n.role||t.formInline,t.formInline.checked_menus=t.formInline.rules,t.$nextTick((function(e){t.selectIds=t.formInline.rules.split(","),t.tidyRes(n.menus)})),t.spinShow=!1;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.spinShow=!1,t.$message.error(e.msg)}))},forChildrenChecked:function(e,t,i){if(e.length)for(var n=e.length,a=0;a<n;a++){var s=this.$refs.tree.getNode(e[a].id).data;t&&(this.$refs.tree.setChecked(s.id,!0),s.checked=!0),t||(this.$refs.tree.setChecked(s.id,!1),s.checked=!1),s.children.length&&this.forChildrenChecked(s.children,t)}},clickDeal:function(e,t,i){if(-1!==t.checkedKeys.indexOf(e.id))this.selectedParent(e),this.uniteChildSame(e,!0);else{0!==e.children.length&&this.uniteChildSame(e,!1);var n=!1,a=e.pid?this.$refs.tree.getNode(e.pid).data:void 0;if(a&&a.children.length)for(var s=0;s<a.children.length;s++)t.checkedKeys.includes(a.children[s].id)&&(n=!0);!n&&e.pid&&this.$refs.tree.setChecked(e.pid,!1)}},uniteChildSame:function(e,t){this.$refs.tree.setChecked(e.id,t);for(var i=0;i<e.children.length;i++)this.uniteChildSame(e.children[i],t)},selectedParent:function(e){e=this.$refs.tree.getNode(e),void 0!==e.parent.key&&(this.$refs.tree.setChecked(e.parent,!0),this.selectedParent(e.parent))},tidyRes:function(e){var t=this,i=[];e.map((function(e){"主页"===e.title?(e.checked=!0,e.children.length&&e.children.map((function(e){e.checked=!0})),i.push(e)):i.push(t.initMenu(e))})),this.$set(this,"menusList",i)},initMenu:function(e){var t=this,i={},n=","+this.formInline.checked_menus+",";return i.title=e.title,i.id=e.id,i.pid=e.pid,i.children=e.children,i.checked=e.checked,e.children&&0<e.children.length?(i.children=[],e.children.map((function(e){i.children.push(t.initMenu(e))}))):(i.checked=-1!==n.indexOf(String(","+i.id+",")),i.expand=!i.checked),i},handleSubmit:function(e){var t=this;this.$refs[e].validate((function(i){return!!i&&(t.formInline.checked_menus=[].concat(Object(n.a)(t.$refs.tree.getCheckedKeys()),Object(n.a)(t.$refs.tree.getHalfCheckedKeys())),0===t.formInline.checked_menus.length?t.$message.warning("请至少选择一个权限"):void Object(o.mb)(t.formInline).then(function(){var i=Object(s.a)(Object(a.a)().mark((function i(n){return Object(a.a)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:t.$message.success(n.msg),t.modals=!1,t.getList(),t.$refs[e].resetFields(),t.formInline.checked_menus=[];case 5:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()).catch((function(e){t.$message.error(e.msg)})))}))},onCancel:function(){this.$refs.formInline.resetFields(),this.formInline.checked_menus=[],this.selectIds=[],this.modals=!1}}},i("ed41"),l=i("2877"),i=Object(l.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"ivu-mb-16",attrs:{bordered:!1,shadow:"never","body-style":{padding:0}}},[t("div",{staticClass:"padding-add"},[t("el-form",{ref:"formValidate",attrs:{model:e.formValidate,"label-width":e.labelWidth,"label-position":e.labelPosition,inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"状态：","label-for":"status"}},[t("el-select",{staticClass:"form_content_width",attrs:{placeholder:"请选择",clearable:""},on:{change:e.userSearchs},model:{value:e.formValidate.status,callback:function(t){e.$set(e.formValidate,"status",t)},expression:"formValidate.status"}},[t("el-option",{attrs:{value:"1",label:"显示"}}),t("el-option",{attrs:{value:"0",label:"不显示"}})],1)],1),t("el-form-item",{attrs:{label:"身份昵称：","label-for":"role_name"}},[t("el-input",{staticClass:"form_content_width",attrs:{clearable:"",placeholder:"请输入身份昵称"},model:{value:e.formValidate.role_name,callback:function(t){e.$set(e.formValidate,"role_name",t)},expression:"formValidate.role_name"}})],1),t("el-form-item",[t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],attrs:{type:"primary"},on:{click:e.userSearchs}},[e._v("查询")])],1)],1)],1)]),t("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.spinShow,expression:"spinShow"}],attrs:{bordered:!1,shadow:"never"}},[t("el-button",{directives:[{name:"auth",rawName:"v-auth",value:["setting-system_role-add"],expression:"['setting-system_role-add']"},{name:"db-click",rawName:"v-db-click"}],attrs:{type:"primary"},on:{click:function(t){return e.add("添加")}}},[e._v("添加身份")]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticClass:"mt14",attrs:{data:e.tableList,"highlight-current-row":"","no-userFrom-text":"暂无数据","no-filtered-userFrom-text":"暂无筛选结果"}},[t("el-table-column",{attrs:{label:"ID","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.id))])]}}])}),t("el-table-column",{attrs:{label:"身份昵称","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.role_name))])]}}])}),t("el-table-column",{attrs:{label:"状态","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-switch",{staticClass:"defineSwitch",attrs:{"active-value":1,"inactive-value":0,value:i.row.status,size:"large","active-text":"显示","inactive-text":"隐藏"},on:{change:function(t){return e.onchangeIsShow(i.row)}},model:{value:i.row.status,callback:function(t){e.$set(i.row,"status",t)},expression:"scope.row.status"}})]}}])}),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"120"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("a",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:function(t){return e.edit(i.row,"编辑")}}},[e._v("编辑")]),t("el-divider",{attrs:{direction:"vertical"}}),t("a",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:function(t){return e.del(i.row,"删除",i.$index)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"acea-row row-right page"},[e.total?t("pagination",{attrs:{total:e.total,page:e.formValidate.page,limit:e.formValidate.limit},on:{"update:page":function(t){return e.$set(e.formValidate,"page",t)},"update:limit":function(t){return e.$set(e.formValidate,"limit",t)},pagination:e.getList}}):e._e()],1)],1),t("el-dialog",{attrs:{visible:e.modals,title:"".concat(e.modelTit,"身份"),"close-on-click-modal":!1,"show-close":!0,width:"540px"},on:{"update:visible":function(t){e.modals=t},closed:e.closed}},[t("el-form",{ref:"formInline",attrs:{model:e.formInline,rules:e.ruleValidate,"label-width":"100px","label-position":e.labelPosition2},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"身份名称：","label-for":"role_name",prop:"role_name"}},[t("el-input",{attrs:{placeholder:"请输入身份昵称"},model:{value:e.formInline.role_name,callback:function(t){e.$set(e.formInline,"role_name",t)},expression:"formInline.role_name"}})],1),t("el-form-item",{attrs:{label:"是否开启：",prop:"status"}},[t("el-radio-group",{model:{value:e.formInline.status,callback:function(t){e.$set(e.formInline,"status",t)},expression:"formInline.status"}},[t("el-radio",{attrs:{label:1}},[e._v("开启")]),t("el-radio",{attrs:{label:0}},[e._v("关闭")])],1)],1),t("el-form-item",{attrs:{label:"权限："}},[t("div",{staticClass:"trees-coadd"},[t("div",{staticClass:"scollhide"},[t("div",{staticClass:"iconlist"},[t("el-tree",{ref:"tree",attrs:{data:e.menusList,"node-key":"id","check-strictly":"","show-checkbox":"","highlight-current":"","default-checked-keys":e.selectIds,props:e.defaultProps,"default-expand-all":e.defaultExpandAll},on:{check:e.clickDeal}})],1)]),t("span",{staticClass:"iconlist-btn",on:{click:e.changeExpandAll}},[e._v(e._s(e.defaultExpandAll?"折叠":"展开"))])])])],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:e.onCancel}},[e._v("取 消")]),t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("formInline")}}},[e._v("提 交")])],1)],1)],1)}),[],!1,null,"76dd5c83",null);t.default=i.exports}}]);