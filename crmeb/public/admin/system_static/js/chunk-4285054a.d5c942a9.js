(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4285054a"],{"6fd3":function(t,e,a){a("498a"),a("14d9"),a("13d5"),a("a434"),a("d3b7");var i=a("c4c8"),n=a("b76a");n={name:"addAttr",components:{draggable:a.n(n).a},data:function(){return{spinShow:!1,modal_loading:!1,grid:{xl:3,lg:3,md:12,sm:24,xs:24},modal:!1,index:1,rules:{rule_name:[{required:!0,message:"请输入规格名称",trigger:"blur"}]},formDynamic:{rule_name:"",spec:[]},attrsName:"",attrsVal:"",formDynamicNameData:[],isBtn:!1,formDynamicName:[],results:[],result:[],ids:0}},computed:{},methods:{handleShowPop:function(t){this.$refs["inputRef_"+t][0].focus()},handleRemoveRole:function(t){this.formDynamic.spec.splice(t,1),this.formDynamic.spec.length||(this.formDynamic.spec=[])},handleAddRole:function(){var t={value:this.formDynamic.attrsName,detail:[]};this.formDynamic.spec.push(t)},onCancel:function(){this.ids=0,this.clear()},onClose:function(){this.ids=0,this.clear(),this.modal=!1},addBtn:function(){this.isBtn=!0},getIofo:function(t){var e=this;this.spinShow=!0,this.ids=t.id,Object(i.S)(t.id).then((function(t){e.formDynamic=t.data.info,e.spinShow=!1})).catch((function(t){e.spinShow=!1,e.$message.error(t.msg)}))},handleSubmit:function(t){var e=this;this.$refs[t].validate((function(t){return!!t&&(0===e.formDynamic.spec.length?e.$message.warning("请至少添加一条商品规格！"):(e.modal_loading=!0,void setTimeout((function(){Object(i.R)(e.formDynamic,e.ids).then((function(t){e.$message.success(t.msg),setTimeout((function(){e.modal=!1,e.modal_loading=!1}),500),setTimeout((function(){e.$emit("getList"),e.clear()}),600)})).catch((function(t){e.modal_loading=!1,e.$message.error(t.msg)}))}),1200)))}))},clear:function(){this.$refs.formDynamic.resetFields(),this.formDynamic.spec=[],this.isBtn=!1,this.attrsName="",this.attrsVal="",this.ids=0},offAttrName:function(){this.isBtn=!1},handleRemove:function(t){this.formDynamic.spec.splice(t,1)},handleRemove2:function(t,e){t.splice(e,1)},createAttrName:function(){var t,e;this.attrsName&&this.attrsVal?(t={value:this.attrsName,detail:[this.attrsVal]},this.formDynamic.spec.push(t),e={},this.formDynamic.spec=this.formDynamic.spec.reduce((function(t,a){return e[a.value]||(e[a.value]=t.push(a)),t}),[]),this.attrsName="",this.attrsVal="",this.isBtn=!1):this.$message.warning("请添加规格名称或规格值")},createAttr:function(t,e){var a;t?(this.formDynamic.spec[e].detail.push(t),a={},this.formDynamic.spec[e].detail=this.formDynamic.spec[e].detail.reduce((function(t,e){return a[e]||(a[e]=t.push(e)),t}),[])):this.$message.warning("请添加属性")}}},a("ad45"),a=a("2877"),a=Object(a.a)(n,(function(){var t=this,e=t._self._c;return e("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.spinShow,expression:"spinShow"}],attrs:{visible:t.modal,title:"商品规格",width:"1000px"},on:{"update:visible":function(e){t.modal=e},closed:t.onCancel}},[e("el-form",{ref:"formDynamic",staticClass:"attrFrom",attrs:{model:t.formDynamic,rules:t.rules,"label-width":"120px","label-position":"right"},nativeOn:{submit:function(t){t.preventDefault()}}},[e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:24}},[e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:"规格模板名称：",prop:"rule_name"}},[e("el-input",{attrs:{placeholder:"请输入标题名称",maxlength:20},model:{value:t.formDynamic.rule_name,callback:function(e){t.$set(t.formDynamic,"rule_name","string"==typeof e?e.trim():e)},expression:"formDynamic.rule_name"}})],1)],1)],1),e("el-col",{key:t.index,staticClass:"noForm",attrs:{span:23}},[e("el-form-item",{attrs:{label:""}},[e("div",{staticClass:"specifications"},[e("draggable",{attrs:{group:"specifications",list:t.formDynamic.spec,handle:".move-icon",animation:"300"}},t._l(t.formDynamic.spec,(function(a,i){return e("div",{key:i,staticClass:"specifications-item active"},[e("div",{staticClass:"move-icon"},[e("span",{staticClass:"iconfont icondrag2"})]),e("i",{staticClass:"del el-icon-error",on:{click:function(e){return t.handleRemoveRole(i)}}}),e("div",{staticClass:"specifications-item-box"},[e("div",{staticClass:"lineBox"}),e("div",{staticClass:"specifications-item-name mb18"},[e("el-input",{staticClass:"specifications-item-name-input",attrs:{placeholder:"规格名称",maxlength:"30","show-word-limit":""},model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"item.value"}})],1),e("div",{staticClass:"rulesBox ml30"},[e("draggable",{staticClass:"item",attrs:{list:a.detail,handle:".drag"}},[t._l(a.detail,(function(i,n){return e("div",{key:n,staticClass:"mr10 spec drag"},[e("i",{staticClass:"el-icon-error",on:{click:function(e){return t.handleRemove2(a.detail,n)}}}),e("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"规格值",maxlength:"30"},model:{value:a.detail[n],callback:function(e){t.$set(a.detail,n,e)},expression:"item.detail[indexn]"}},[e("template",{slot:"prefix"},[e("span",{staticClass:"iconfont icondrag2"})])],2)],1)})),e("el-popover",{ref:"popoverRef_"+i,refInFor:!0,attrs:{placement:"",width:"210",trigger:"click"},on:{"after-enter":function(e){return t.handleShowPop(i)}}},[e("el-input",{ref:"inputRef_"+i,refInFor:!0,attrs:{placeholder:"请输入规格值",maxlength:"30","show-word-limit":""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.createAttr(a.detail.attrsVal,i)}},model:{value:a.detail.attrsVal,callback:function(e){t.$set(a.detail,"attrsVal",e)},expression:"item.detail.attrsVal"}}),e("div",{directives:[{name:"db-click",rawName:"v-db-click"}],staticClass:"addfont",attrs:{slot:"reference",type:"text"},slot:"reference"},[t._v("添加规格值")])],1)],2)],1)])])})),0),t.formDynamic.spec.length<4?e("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:function(e){return t.handleAddRole()}}},[t._v("添加新规格")]):t._e()],1)])],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:t.onClose}},[t._v("取消")]),e("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],attrs:{type:"primary",loading:t.modal_loading},on:{click:function(e){return t.handleSubmit("formDynamic")}}},[t._v("确定")])],1)],1)}),[],!1,null,"5ceddc1e",null);e.a=a.exports},"7f08":function(t,e,a){a.r(e);var i=a("2909"),n=a("5530"),s=(a("caad"),a("a15b"),a("14d9"),a("d3b7"),a("6062"),a("3ca3"),a("88e6"),a("70cc"),a("eb03"),a("22e5"),a("c01e"),a("fa76"),a("8306"),a("159b"),a("ddb0"),a("2f62")),r=a("6fd3"),l=a("c4c8");r={name:"productAttr",components:{addAttr:r.a},data:function(){return{loading:!1,artFrom:{page:1,limit:20,rule_name:""},tableList:[],total:0,selectedIds:new Set,ids:[],multipleSelection:[]}},computed:Object(n.a)({},Object(s.d)("admin/order",["orderChartType"])),created:function(){this.getDataList()},methods:{getRowKey:function(t){return t.id},handleSelectAll:function(t){var e=this;0===t.length?this.$refs.table.data.forEach((function(t){e.selectedIds.has(t.id)&&e.selectedIds.delete(t.id)})):t.forEach((function(t){e.selectedIds.add(t.id)})),this.$nextTick((function(){e.setChecked()}))},handleSelectRow:function(t){for(var e=this,a=[],i=[],n=0;n<t.length;n++){var s=t[n];i.includes(s.id)||(a.push(s),i.push(s.id))}this.selectedIds=i,this.multipleSelection=a,this.$nextTick((function(t){e.setChecked()}))},setChecked:function(){this.ids=Object(i.a)(this.selectedIds).join(",")},del:function(t,e){var a=this,i={};if("批量删除规格"===e){if(0===this.selectedIds.size)return this.$message.warning("请选择要删除的规格！");i={ids:this.ids}}else i={ids:t.id};this.$modalSure({title:e,num:0,url:"product/product/rule/delete",method:"DELETE",ids:i}).then((function(t){a.$message.success(t.msg),a.getDataList()})).catch((function(t){a.$message.error(t.msg)}))},addAttr:function(){this.$refs.addattr.modal=!0},edit:function(t){this.$refs.addattr.modal=!0,this.$refs.addattr.getIofo(t)},getDataList:function(){var t=this;this.loading=!0,Object(l.T)(this.artFrom).then((function(e){var a=e.data;t.tableList=a.list,t.$nextTick((function(){t.setChecked()})),t.total=e.data.count,t.loading=!1})).catch((function(e){t.loading=!1,t.$message.error(e.msg)}))},userSearchs:function(){this.artFrom.page=1,this.getDataList()}}},n=a("2877"),s=Object(n.a)(r,(function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"ivu-mt",attrs:{bordered:!1,shadow:"never","body-style":{padding:0}}},[e("div",{staticClass:"padding-add"},[e("el-form",{ref:"artFrom",staticClass:"tabform",attrs:{model:t.artFrom,"label-width":"80px","label-position":"right",inline:""},nativeOn:{submit:function(t){t.preventDefault()}}},[e("el-form-item",{attrs:{label:"规格搜索："}},[e("el-input",{staticClass:"form_content_width",attrs:{clearable:"",placeholder:"请输入规格名称"},model:{value:t.artFrom.rule_name,callback:function(e){t.$set(t.artFrom,"rule_name",e)},expression:"artFrom.rule_name"}})],1),e("el-form-item",[e("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],attrs:{type:"primary"},on:{click:t.userSearchs}},[t._v("查询")])],1)],1)],1)]),e("el-card",{staticClass:"ivu-mt mt16",attrs:{bordered:!1,shadow:"never"}},[e("el-button",{directives:[{name:"auth",rawName:"v-auth",value:["product-rule-save"],expression:"['product-rule-save']"},{name:"db-click",rawName:"v-db-click"}],attrs:{type:"primary"},on:{click:t.addAttr}},[t._v("添加商品规格")]),e("el-button",{directives:[{name:"auth",rawName:"v-auth",value:["product-product-rule-delete"],expression:"['product-product-rule-delete']"},{name:"db-click",rawName:"v-db-click"}],on:{click:function(e){return t.del(null,"批量删除规格")}}},[t._v("批量删除")]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"table",staticClass:"mt14",attrs:{data:t.tableList,"highlight-current-row":"","row-key":t.getRowKey,"empty-text":"暂无数据"},on:{"selection-change":t.handleSelectRow}},[e("el-table-column",{attrs:{type:"selection",width:"60","reserve-selection":!0}}),e("el-table-column",{attrs:{label:"ID",width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.id))])]}}])}),e("el-table-column",{attrs:{label:"规格名称","min-width":"130"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.rule_name))])]}}])}),e("el-table-column",{attrs:{label:"商品规格","min-width":"130"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.attr_name))])]}}])}),e("el-table-column",{attrs:{label:"商品属性","min-width":"130"},scopedSlots:t._u([{key:"default",fn:function(a){return t._l(a.row.attr_value,(function(a,i){return e("span",{key:i,staticStyle:{display:"block"},domProps:{textContent:t._s(a)}})}))}}])}),e("el-table-column",{attrs:{label:"操作",fixed:"right",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("a",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:function(e){return t.edit(a.row)}}},[t._v("编辑")]),e("el-divider",{attrs:{direction:"vertical"}}),e("a",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:function(e){return t.del(a.row,"删除规格",a.$index)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"acea-row row-right page"},[t.total?e("pagination",{attrs:{total:t.total,page:t.artFrom.page,limit:t.artFrom.limit},on:{"update:page":function(e){return t.$set(t.artFrom,"page",e)},"update:limit":function(e){return t.$set(t.artFrom,"limit",e)},pagination:t.getDataList}}):t._e()],1)],1),e("add-attr",{ref:"addattr",on:{getList:t.userSearchs}})],1)}),[],!1,null,"4c293be6",null);e.default=s.exports},ad45:function(t,e,a){a("dfba")},dfba:function(t,e,a){}}]);