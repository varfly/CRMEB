(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-14504f1c","chunk-1835ef2f"],{"0f0e":function(e,t,a){a("4de4"),a("d81d"),a("14d9"),a("a434"),a("e9c4"),a("b64b"),a("d3b7");var i=a("c4c8"),s={name:"userLabel",props:{},data:function(){return{labelList:[],dataLabel:[],isUser:!1}},mounted:function(){this.setLabel()},methods:{inArray:function(e,t){for(var a in t)if(t[a].id==e)return!0;return!1},setLabel:function(){var e=this;Object(i.O)().then((function(t){t.data.map((function(t){t.children&&(e.isUser=!0,t.children.map((function(t){e.inArray(t.id,e.dataLabel)?t.disabled=!0:t.disabled=!1})))})),e.labelList=t.data})).catch((function(t){e.$message.error(t.msg)}))},selectLabel:function(e){var t;e.disabled?(t=this.dataLabel.indexOf(this.dataLabel.filter((function(t){return t.id==e.id}))[0]),this.dataLabel.splice(t,1),e.disabled=!1):(this.dataLabel.push({label_name:e.label_name,id:e.id}),e.disabled=!0)},subBtn:function(){this.$emit("activeData",JSON.parse(JSON.stringify(this.dataLabel)))},cancel:function(){this.$emit("close")}}};a("c056"),a=a("2877"),a=Object(a.a)(s,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"label-wrapper"},[t("div",{staticClass:"list-box"},[e.isUser?e._l(e.labelList,(function(a,i){return t("div",{key:i,staticClass:"label-box"},[a.children?t("div",{staticClass:"title"},[e._v(e._s(a.label_name))]):e._e(),a.children&&a.children.length?t("div",{staticClass:"list"},e._l(a.children,(function(a,i){return t("div",{directives:[{name:"db-click",rawName:"v-db-click"}],key:i,staticClass:"label-item",class:{on:a.disabled},on:{click:function(t){return e.selectLabel(a)}}},[e._v("\n            "+e._s(a.label_name)+"\n          ")])})),0):e._e()])})):e._e(),e.isUser?e._e():t("div",[e._v("暂无标签")])],2),t("div",{staticClass:"footer"},[t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],staticClass:"btns",attrs:{ghost:""},on:{click:e.cancel}},[e._v("取消")]),t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],staticClass:"btns",attrs:{type:"primary"},on:{click:e.subBtn}},[e._v("确定")])],1)])}),[],!1,null,"060b86af",null);t.a=a.exports},"0faed":function(e,t,a){a("0fe9")},"0fe9":function(e,t,a){},2599:function(e,t,a){},6950:function(e,t,a){a("9441")},"8c03":function(e,t,a){a.r(t);var i=a("c7eb"),s=a("1da1"),r=(a("a15b"),a("d81d"),a("c73d"),a("90e7")),l={name:"index",data:function(){return{formValidate:{page:1,limit:15,data:"",nickname:""},tableList2:[],timeVal:[],fromList:{title:"选择时间",custom:!0,fromTxt:[{text:"全部",val:""},{text:"今天",val:"today"},{text:"昨天",val:"yesterday"},{text:"最近7天",val:"lately7"},{text:"最近30天",val:"lately30"},{text:"本月",val:"month"},{text:"本年",val:"year"}]},currentid:0,productRow:{},loading2:!1,total2:0}},created:function(){},mounted:function(){this.getListService()},methods:{onchangeTime:function(e){this.timeVal=e,this.formValidate.data=this.timeVal?this.timeVal.join("-"):"",this.getListService()},selectChange:function(e){this.formValidate.data=e,this.timeVal=[],this.getListService()},getListService:function(){var e=this;this.loading2=!0,Object(r.H)(this.formValidate).then(function(){var t=Object(s.a)(Object(i.a)().mark((function t(a){var s;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=a.data,e.tableList2=s.list,e.total2=s.count,e.tableList2.map((function(e){e._isChecked=!1})),e.loading2=!1;case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.loading2=!1,e.$message.error(t.msg)}))},userSearchs:function(){this.formValidate.page=1,this.getListService()},currentidRadio:function(e){self.currentid=e.uid,this.productRow=e,this.productRow.uid?"image"===this.$route.query.fodder?(e={image:this.productRow.headimgurl,uid:this.productRow.uid},form_create_helper.set("image",e),form_create_helper.close("image")):this.$emit("imageObject",{image:this.productRow.headimgurl,uid:this.productRow.uid}):this.$message.warning("请先选择商品")}}};a("0faed"),a=a("2877"),a=Object(a.a)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"customer"},[t("el-form",{ref:"formValidate",attrs:{model:e.formValidate,"label-width":"80px",inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"搜索用户："}},[t("el-input",{staticClass:"form_content_width",attrs:{clearable:"",placeholder:"请输入用户UID、昵称或手机号"},model:{value:e.formValidate.nickname,callback:function(t){e.$set(e.formValidate,"nickname",t)},expression:"formValidate.nickname"}})],1),t("el-form-item",[t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],attrs:{type:"primary"},on:{click:e.userSearchs}},[e._v("查询")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading2,expression:"loading2"}],ref:"selection",staticClass:"mt15",attrs:{"highlight-current-row":"","no-userFrom-text":"暂无数据","no-filtered-userFrom-text":"暂无筛选结果",data:e.tableList2,height:"450"}},[t("el-table-column",{attrs:{width:"50"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-radio",{attrs:{disabled:!!a.row.is_del,label:a.row.uid},on:{input:function(){return e.currentidRadio(a.row)}},model:{value:e.currentid,callback:function(t){e.currentid=t},expression:"currentid"}},[e._v(" ")])]}}])}),t("el-table-column",{attrs:{label:"UID",width:"80"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.uid))])]}}])}),t("el-table-column",{attrs:{label:"用户头像","min-width":"90"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("div",{directives:[{name:"viewer",rawName:"v-viewer"}],staticClass:"tabBox_img"},[t("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.row.headimgurl,expression:"scope.row.headimgurl"}]})])]}}])}),t("el-table-column",{attrs:{label:"用户昵称","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[e._v(e._s(a.row.nickname))]),t("div",{staticStyle:{color:"red"}},[e._v(e._s(a.row.is_del?"用户已注销":""))])]}}])}),t("el-table-column",{attrs:{label:"手机号","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[e._v(e._s(a.row.phone))])]}}])}),t("el-table-column",{attrs:{label:"是否关注公众号","min-width":"130"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{domProps:{textContent:e._s(1===a.row.subscribe?"关注":"未关注")}})]}}])}),t("el-table-column",{attrs:{label:"注册时间","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[e._v(e._s(a.row.add_time))])]}}])})],1),t("div",{staticClass:"acea-row row-right page"},[e.total2?t("pagination",{attrs:{total:e.total2,page:e.formValidate.page,limit:e.formValidate.limit},on:{"update:page":function(t){return e.$set(e.formValidate,"page",t)},"update:limit":function(t){return e.$set(e.formValidate,"limit",t)},pagination:e.getListService}}):e._e()],1)],1)}),[],!1,null,"559966ff",null);t.default=a.exports},9441:function(e,t,a){},c056:function(e,t,a){a("2599")},ed2f:function(e,t,a){a.r(t),a("b0c0");var i=a("5530"),s=(a("4de4"),a("d81d"),a("14d9"),a("a434"),a("e9c4"),a("b64b"),a("d3b7"),a("498a"),a("2f62")),r=a("0f0e"),l=a("c4ad"),n=a("c42b"),o=a("c4c8"),c=a("c24f"),d=a("90e7"),m=a("d708"),u=a("c276"),f=a("8c03"),b=a("ed08");l={name:"createCode",components:{goodsList:l.default,newsCategory:n.a,customerInfo:f.default,userLabel:r.a},data:function(){return{customerShow:!1,labelShow:!1,disabled:!1,maxCols:4,labelSelect:[],scrollerHeight:"600",contentTop:"10",contentWidth:"98%",formatImg:["jpg","jpeg","png","bmp","gif"],formatVoice:["mp3","wma","wav","amr"],header:{},fileUrl:m.a.apiBaseURL+"/file/upload/1",formData:{name:"",type:"text",time:void 0,label_id:[],image:"",cate_id:"",content:{content:"",src:"",list:{}}},labelSort:[],isReceiveTime:0,modals:!1,ruleValidate:{name:[{required:!0,message:"请填写二维码名称",trigger:"blur"}],cate_id:[{required:!0,message:"请选择二维码分组",trigger:"change"}]},id:0,dataLabel:[],loading:!1}},computed:Object(i.a)({},Object(s.d)("media",["isMobile"])),created:function(){this.getUserLabelAll(),this.userLabel(),this.getToken(),this.$route.query.id&&(this.id=this.$route.query.id,this.getDetail())},methods:{beforeUpload:function(e){return Object(b.c)(e)},activeData:function(e){this.labelShow=!1,this.dataLabel=e},labelClose:function(){this.labelShow=!1},openLabel:function(e){this.labelShow=!0,this.dataLabel.length&&this.$refs.userLabel.userLabel(JSON.parse(JSON.stringify(this.dataLabel)))},closeLabel:function(e){var t=this.dataLabel.indexOf(this.dataLabel.filter((function(t){return t.id==e.id}))[0]);this.dataLabel.splice(t,1)},getDetail:function(){var e=this;Object(d.hc)(this.id).then((function(t){e.formData=t.data,0<t.data.time&&(e.isReceiveTime=1),t.data.label_id.length&&(e.dataLabel=t.data.label_id)}))},customer:function(){this.customerShow=!0},addLabel:function(){var e=this;this.$modalForm(Object(c.M)(0)).then((function(){return e.userLabel()}))},userLabel:function(){var e=this;Object(o.p)().then((function(t){e.labelSelect=t.data.list})).catch((function(t){e.$message.error(t.msg)}))},imageObject:function(e){this.customerShow=!1,this.formData.uid=e.uid,this.formData.avatar=e.image},getCentList:function(e){this.formData.content.list=e.new[0],this.modals=!1},delContent:function(){this.formData.content.list={}},handleSuccess:function(e,t){200===e.status?(this.formData.content.src=e.data.src,this.$message.success(e.msg)):this.$message.error(e.msg)},handleFormatError:function(e){"image"===this.formData.type?this.$message.warning("请上传bmp/png/jpeg/jpg/gif格式的图片"):this.$message.warning("请上传mp3/wma/wav/amr格式的语音")},handleMaxSize:function(e){this.$message.warning("请上传文件2M以内的文件")},getToken:function(){this.header["Authori-zation"]="Bearer "+Object(u.c)("token")},selectMenu:function(e){this.formData.type=e},getUserLabelAll:function(){var e=this;Object(d.lc)().then((function(t){t=t.data.data,e.labelSort=t}))},save:function(){var e=this;if(!this.formData.name)return this.$message.error("请输入二维码名称");if(!this.formData.cate_id)return this.$message.error("请选择分组");if(!this.dataLabel.length)return this.$message.error("请选择用户标签");var t=[];if(this.dataLabel.map((function(e){t.push(e.id)})),this.formData.label_id=t,!this.formData.uid)return this.$message.error("请选择推广员");if(this.isReceiveTime){if(this.formData.time<1)return this.$message.error("使用有效期限不能小于1天")}else this.formData.time=0;return"text"!==this.formData.type&&"url"!==this.formData.type||this.formData.content.content.trim()?"voice"!==this.formData.type&&"image"!==this.formData.type||this.formData.content.src.trim()?"news"!==this.formData.type||this.formData.content.list.title.trim()?(this.disabled=!1,this.loading=!0,void Object(d.jc)(this.id,this.formData).then((function(t){e.disabled=!0,e.$message.success(t.msg),setTimeout((function(){e.$router.push({path:e.$routeProStr+"/marketing/channel_code/channelCodeIndex"})}),1e3)})).catch((function(t){e.disabled=!0,e.$message.error(t.msg)}))):this.$message.error("请选择图文消息"):this.$message.error("请先上传消息"):this.$message.error("请输入内容")}}},a("6950"),n=a("2877"),f=Object(n.a)(l,(function(){var e=this,t=e._self._c;return t("div",[t("pages-header",{ref:"pageHeader",attrs:{title:e.$route.meta.title,backUrl:e.$routeProStr+"/marketing/channel_code/channelCodeIndex"}}),t("el-card",{staticClass:"mt16",attrs:{bordered:!1,shadow:"never"}},[t("el-form",{attrs:{model:e.formData,"label-width":"100px",rules:e.ruleValidate}},[t("el-form-item",{attrs:{label:"渠道码名称："}},[t("el-input",{staticClass:"content_width",attrs:{clearable:"",placeholder:"请输入渠道码名称",maxlength:"20","show-word-limit":""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:"渠道码分组："}},[t("el-select",{staticClass:"content_width",attrs:{clearable:""},model:{value:e.formData.cate_id,callback:function(t){e.$set(e.formData,"cate_id",t)},expression:"formData.cate_id"}},e._l(e.labelSort,(function(e,a){return t("el-option",{key:a,attrs:{value:e.id,label:e.cate_name}})})),1)],1),t("el-form-item",{attrs:{label:"用户标签："}},[t("div",{staticStyle:{display:"flex"}},[t("div",{directives:[{name:"db-click",rawName:"v-db-click"}],staticClass:"labelInput acea-row row-between-wrapper",on:{click:e.openLabel}},[t("div",{staticStyle:{width:"90%"}},[e.dataLabel.length?t("div",e._l(e.dataLabel,(function(a,i){return t("el-tag",{key:i,attrs:{closable:""},on:{close:function(t){return e.closeLabel(a)}}},[e._v(e._s(a.label_name))])})),1):t("span",{staticClass:"span"},[e._v("选择用户关联标签")])]),t("div",{staticClass:"ivu-icon ivu-icon-ios-arrow-down"})]),t("span",{directives:[{name:"db-click",rawName:"v-db-click"}],staticClass:"addfont",on:{click:e.addLabel}},[e._v("新增标签")])])]),t("el-form-item",{attrs:{label:"关联推广员："}},[t("div",{directives:[{name:"db-click",rawName:"v-db-click"}],staticClass:"picBox",on:{click:e.customer}},[e.formData.avatar?t("div",{staticClass:"pictrue"},[t("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.formData.avatar,expression:"formData.avatar"}]})]):t("div",{staticClass:"upLoad acea-row row-center-wrapper"},[t("i",{staticClass:"el-icon-user",staticStyle:{"font-size":"24px"}})])]),t("div",{staticClass:"trip"},[e._v("扫码注册的新用户,将自动成为此推广员的下级,与分销推广功能一致")])]),t("el-form-item",{attrs:{label:"有效期："}},[t("el-radio-group",{model:{value:e.isReceiveTime,callback:function(t){e.isReceiveTime=t},expression:"isReceiveTime"}},[t("el-radio",{attrs:{label:0}},[e._v("永久")]),t("el-radio",{attrs:{label:1}},[e._v("有效期")])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isReceiveTime,expression:"isReceiveTime"}]},[t("el-input-number",{staticClass:"content_width input-number-unit-class",attrs:{controls:!1,max:1e4,precision:0,placeholder:"请输入天数","class-unit":"天"},model:{value:e.formData.time,callback:function(t){e.$set(e.formData,"time",t)},expression:"formData.time"}})],1),t("div",{staticClass:"trip"},[e._v("临时码过期后不能再扫码,永久二维码最大创建数量为10万个")])],1),t("el-form-item",{attrs:{label:"回复内容："}},[t("el-radio-group",{model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}},[t("el-radio",{attrs:{label:"text"}},[e._v("文字内容")]),t("el-radio",{attrs:{label:"voice"}},[e._v("声音消息")]),t("el-radio",{attrs:{label:"image"}},[e._v("图片消息")]),t("el-radio",{attrs:{label:"news"}},[e._v("图文消息")])],1)],1),"text"===e.formData.type||"url"===e.formData.type?t("el-form-item",{attrs:{label:"消息内容：",prop:"content"}},[t("el-input",{staticClass:"content_width",attrs:{type:"textarea",rows:"2",clearable:"",placeholder:"text"===e.formData.type?"请填写消息内容":"请填写网址链接"},model:{value:e.formData.content.content,callback:function(t){e.$set(e.formData.content,"content",t)},expression:"formData.content.content"}})],1):e._e(),"news"===e.formData.type?t("el-form-item",{attrs:{label:"选取图文："}},[t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],on:{click:function(t){e.modals=!0}}},[e._v("选择图文消息")]),e.formData.content.list.title?t("div",{staticClass:"news-box"},[t("img",{staticClass:"news_pic",attrs:{src:e.formData.content.list.image_input[0]}}),t("span",[e._v(e._s(e.formData.content.list.title))]),t("i",{directives:[{name:"db-click",rawName:"v-db-click"}],staticClass:"el-icon-error del_icon",on:{click:e.delContent}})]):e._e()],1):e._e(),"image"===e.formData.type||"voice"===e.formData.type?t("el-form-item",{attrs:{label:"image"===e.formData.type?"图片地址：":"语音地址：",prop:"src"}},[t("div",{staticClass:"acea-row row-middle"},[t("el-input",{staticClass:"content_width mr15",attrs:{readonly:"readonly",placeholder:"请填入链接地址"},model:{value:e.formData.content.src,callback:function(t){e.$set(e.formData.content,"src",t)},expression:"formData.content.src"}}),t("el-upload",{staticClass:"mr20",staticStyle:{"margin-top":"1px"},attrs:{"show-file-list":!1,action:e.fileUrl,"on-success":e.handleSuccess,format:"image"===e.formData.type?e.formatImg:e.formatVoice,"max-size":2048,headers:e.header,"on-format-error":e.handleFormatError,"on-exceeded-size":e.handleMaxSize,accept:"image/*","before-upload":e.beforeUpload}},[t("el-button",{attrs:{type:"primary"}},[e._v("上传")])],1)],1),t("span",{directives:[{name:"show",rawName:"v-show",value:"image"===e.formData.type,expression:"formData.type === 'image'"}]},[e._v("文件最大2Mb，支持bmp/png/jpeg/jpg/gif格式")]),t("span",{directives:[{name:"show",rawName:"v-show",value:"voice"===e.formData.type,expression:"formData.type === 'voice'"}]},[e._v("文件最大2Mb，支持mp3格式,播放长度不超过60s")])]):e._e(),t("el-form-item",[t("el-button",{directives:[{name:"db-click",rawName:"v-db-click"}],staticClass:"submit",attrs:{type:"primary",loading:e.loading,disabled:e.disabled},on:{click:e.save}},[e._v("立即提交")])],1)],1)],1),t("el-dialog",{attrs:{visible:e.customerShow,title:"请选择商城用户","show-close":!0,width:"1000px"},on:{"update:visible":function(t){e.customerShow=t}}},[e.customerShow?t("customerInfo",{on:{imageObject:e.imageObject}}):e._e()],1),t("el-dialog",{staticClass:"modelBox",attrs:{visible:e.modals,title:"发送消息",width:"1200px"},on:{"update:visible":function(t){e.modals=t}}},[e.modals?t("news-category",{attrs:{scrollerHeight:e.scrollerHeight,contentTop:e.contentTop,contentWidth:e.contentWidth,maxCols:e.maxCols},on:{getCentList:e.getCentList}}):e._e()],1),t("el-dialog",{attrs:{visible:e.labelShow,scrollable:"",title:"请选择用户标签",closable:!1,width:"540px","footer-hide":!0,"mask-closable":!1},on:{"update:visible":function(t){e.labelShow=t}}},[t("userLabel",{ref:"userLabel",on:{activeData:e.activeData,close:e.labelClose}})],1)],1)}),[],!1,null,"1d9f6a0e",null);t.default=f.exports}}]);